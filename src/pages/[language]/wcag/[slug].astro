---
import fetchApi from '../../../lib/payload';
import Layout from '../../../layouts/Layout.astro';
import Guidelines from '../../../components/Guidelines.astro';
import SidebarMenu from '../../../components/SidebarMenu.astro';
import Breadcrumb from '../../../components/Breadcrumb.astro';
import RichText from '../../../components/RichText';
import type RichTextNode from '../../../interfaces/RichText';
import type { Principle } from '../../../interfaces/wcag';

export async function getStaticPaths() {
  const pages = await fetchApi<Principle[]>({
    endpoint: 'principles',
    global: false,
    wrappedByKey: 'docs',
  });

  const languages = ['en', 'fi'] as const;

  return pages.flatMap((page: Principle) =>
    languages.map((lang) => ({
      params: {
        language: lang,
        slug: page.slug[lang],
      },
      props: {
        ...page,
        lang,
      },
    }))
  );
}

type LangKey = 'en' | 'fi';
interface Props extends Principle {
  lang: LangKey;
}
const { lang, ...page } = Astro.props as Props;

const nodes = (page.content[lang]) ? page.content[lang].root.children as RichTextNode[] : null;
---

<Layout type="other" metaDescription={ page.metaDescription[lang] } locale={ lang } title={ page.title[lang] }
engUrl={ page.pageUrl[lang] } fiUrl={ page.pageUrl[lang] } currentUrl={ page.pageUrl[lang] } currentSlug={ page.pageUrl[lang] }
alternateFi={`fi/${ page.pageUrl['fi'] }`} alternateEn={`en/${ page.pageUrl['en'] }`}
>
  <SidebarMenu principleNumber={ page.principleNumber } principleName={ page.title[lang] } />
  <div class="max-w-[1564px] mx-auto md:px-8-px max-sm:order-1">
    <div class="text-lt-gray dark:text-dk-gray py-2 px-4-px max-w-xl mx-auto md:py-6 md:px-8-px lg:max-w-4xl">
      <Breadcrumb type="principle"
        language={ lang }
        currentNumber={ page.principleNumber }
        currentPage={ page.title[lang] }
      />
      <h1 id="skip-target">{ page.principleNumber } { page.title[lang] }</h1>
      {nodes &&        
        <div class="text-xl bodytext"><RichText client:load nodes={nodes} lang={lang} /></div>
      }
      <Guidelines principleNumber={ page.principleNumber } lang={ lang } />
    </div>
  </div>
</Layout>


